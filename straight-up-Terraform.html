
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://sagargiri.com/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="https://sagargiri.com/theme/pygments/default.min.css">



  <link rel="stylesheet" type="text/css" href="https://sagargiri.com/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://sagargiri.com/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://sagargiri.com/theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="https://sagargiri.com/static/custom.css">

  <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon">
  <link rel="icon" href="/images/favicon.png" type="image/x-icon">

  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#333333">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#333333">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Microsoft EDGE -->
  <meta name="msapplication-TileColor" content="#333333">

  <link href="https://sagargiri.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Sagar's Blog Atom">


<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-73000395-1', 'auto');
  ga('send', 'pageview');
</script>






 

<meta name="author" content="Sagar Giri" />
<meta name="description" content="This is the very detailed introduction to getting started with Terraform" />
<meta name="keywords" content="Terraform, IAC, Terraform Cloud">


  <meta property="og:site_name" content="Sagar's Blog"/>
  <meta property="og:title" content="Terraform: Getting Started from Zero"/>
  <meta property="og:description" content="This is the very detailed introduction to getting started with Terraform"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://sagargiri.com/straight-up-Terraform"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2021-01-17 21:32:00+09:00"/>
  <meta property="article:modified_time" content="2021-01-17 21:32:00+09:00"/>
  <meta property="article:author" content="https://sagargiri.com/author/sagar-giri.html">
  <meta property="article:section" content="misc"/>
  <meta property="article:tag" content="Terraform"/>
  <meta property="article:tag" content="IAC"/>
  <meta property="article:tag" content="Terraform Cloud"/>
  <meta property="og:image" content="/images/title.png">

  <title>Sagar's Blog &ndash; Terraform: Getting Started from Zero</title>


<script>
  (function(w,d,s,l,i){
    w[l]=w[l]||[];
    w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
    j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
    f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5K6D7ZG');
</script>
<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "7cfbr3w8ss");
</script>
</head>
<body class="light-theme">
<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5K6D7ZG" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>

<aside>
  <div>
    <a href="https://sagargiri.com/">
      <img src="/images/title.png" alt="Sagar Giri" title="Sagar Giri">
    </a>

    <h1>
      <a href="https://sagargiri.com/">Sagar Giri</a>
    </h1>

    <p><pre>$ cd /pub && more beer</pre></p>


    <nav>
      <ul class="list">


            <li>
              <a target="_self"
                 href="https://sagargiri.com/pages/about-me#about-me">
                About Me
              </a>
            </li>

          <li>
            <a target="_self" href="https://girisagar46.github.io/FYPFruitClassifier/" >Project</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-linkedin"
           href="https://linkedin.com/in/girisagar46"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-github"
           href="https://github.com/girisagar46"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-stack-overflow"
           href="https://stackoverflow.com/story/girisagar46.github.io"
           target="_blank">
          <i class="fa-brands fa-stack-overflow"></i>
        </a>
      </li>
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://fosstodon.org/@girisagar46"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="https://sagargiri.com/">Home</a>

  <a href="/archives">Archives</a>
  <a href="/categories">Categories</a>
  <a href="/tags">Tags</a>

  <a href="https://sagargiri.com/feeds/all.atom.xml">Atom</a>

</nav>

<article class="single">
  <header>
      
    <h1 id="straight-up-Terraform">Terraform: Getting Started from Zero</h1>
    <p>
      Posted on January 17, 2021 in <a href="https://sagargiri.com/category/misc">misc</a>

    </p>
  </header>


  <div>
    <blockquote>
<p>Terraform is an open-source infrastructure as code software tool that enables you to safely and predictably create, change, and improve infrastructure. - www.Terraform.io</p>
</blockquote>
<!--toc-->

<ul>
<li><a href="#chapter-1-introduction-to-iac">Chapter 1: Introduction to IaC</a><ul>
<li><a href="#11-begin-with-a-look-back">1.1 Begin with a look back</a></li>
<li><a href="#12-why-infrastructure-as-code">1.2 Why infrastructure as code?</a></li>
<li><a href="#13-terminology">1.3 Terminology</a></li>
<li><a href="#14-explore-approaches-to-iac">1.4 Explore approaches to IaC</a></li>
</ul>
</li>
<li><a href="#chapter-2-terraform">Chapter 2: Terraform</a><ul>
<li><a href="#21-what-is-terraform">2.1 What is Terraform?</a></li>
<li><a href="#22-install-terraform">2.2 Install Terraform</a></li>
<li><a href="#23-terraform-tour">2.3 Terraform Tour</a></li>
<li><a href="#24-the-very-basics-of-terraform">2.4 The very "Basics of Terraform"</a></li>
</ul>
</li>
<li><a href="#chapter-3-learning-hcl">Chapter 3: Learning HCL</a><ul>
<li><a href="#31-overview-of-hcl-structure">3.1 Overview of HCL structure</a></li>
<li><a href="#32-terraform-data-sources-and-resources">3.2 Terraform data sources and resources</a></li>
<li><a href="#33-terraform-outputs">3.3 Terraform Outputs</a></li>
<li><a href="#34-interpolation-in-hcl">3.4 Interpolation in HCL</a></li>
<li><a href="#35-dependencies-in-terraform">3.5 Dependencies in Terraform</a></li>
<li><a href="#36-variables-and-locals">3.6 Variables and Locals</a></li>
<li><a href="#37-conditionals-and-the-count-property">3.7 Conditionals and the Count property</a></li>
<li><a href="#38-data-types-and-operators">3.8 Data types and operators</a></li>
<li><a href="#39-functions">3.9 Functions</a></li>
<li><a href="#310-iterations-in-collections">3.10 Iterations in collections</a></li>
<li><a href="#311-directives-and-heredocs">3.11 Directives and heredocs</a></li>
<li><a href="#312-clean-up">3.12 Clean up</a></li>
</ul>
</li>
<li><a href="#chapter-4-code-re-use-for-applying-dry">Chapter 4: Code Re-Use for applying DRY</a><ul>
<li><a href="#41-understanding-terraform-modules">4.1 Understanding Terraform Modules</a></li>
<li><a href="#42-distributing-modules">4.2 Distributing modules</a></li>
</ul>
</li>
<li><a href="#chapter-5-collaboration-with-terraform">Chapter 5: Collaboration with Terraform</a><ul>
<li><a href="#51-terraform-backends">5.1 Terraform backends</a></li>
<li><a href="#52-terraform-workspaces">5.2 Terraform workspaces</a></li>
</ul>
</li>
</ul>
<h1>Chapter 1: Introduction to IaC</h1>
<h2>1.1 Begin with a look back</h2>
<ul>
<li>[1960-1970] - Mainframe Computers<ul>
<li>Big machines</li>
<li>Big facilities and using fork-lifts to move machines</li>
<li>Automation was not that critical in this era</li>
</ul>
</li>
<li>[1980-1990] - Client/Server World<ul>
<li>Things started to get little more complicated</li>
<li>UNIX or PC servers running various OS</li>
<li>These machines serve users using networking</li>
</ul>
</li>
<li>[Mid 90's-2000] - Virtualization<ul>
<li>Software defines infrastructures</li>
<li>Hardware were virtualized</li>
<li>Clients do not have any hardware debt</li>
</ul>
</li>
<li>Cloud Era<ul>
<li>No hardware to manage</li>
<li>It's all software management problem</li>
<li>All these things could be managed by API's, Scripts</li>
<li>Manage all the infrastructures by the code</li>
</ul>
</li>
</ul>
<h2>1.2 Why infrastructure as code?</h2>
<ul>
<li>Repeatability<ul>
<li>We can deploy the same thing over and over again</li>
<li>We'll have a backup</li>
<li>We can have multiple environments (dev, stage, prod)</li>
</ul>
</li>
<li>Auditability<ul>
<li>We can see what changed, who changed and impact of change</li>
<li>We can detect the problems easily</li>
</ul>
</li>
<li>Change control<ul>
<li>Allows us to use VCS to control what to change</li>
</ul>
</li>
<li>Collaboration<ul>
<li>Multiple people can work together on the same code base</li>
<li>Example: Use GitHub to propose a change</li>
</ul>
</li>
</ul>
<h2>1.3 Terminology</h2>
<ul>
<li><strong>IaC</strong> - Infrastructure as Code</li>
<li><strong>CM</strong> - Configuration Management (Example: Ansible, Puppet, etc)</li>
<li><strong>IaaS</strong> - Infrastructure as a Service (Example: AWS, GoogleCloud, Azure)</li>
<li><strong>PaaS</strong> - Platform as a Service (Example: Heroku, AWS EBS)</li>
<li><strong>VCS</strong> - Version Control System</li>
<li><strong>CI/CD</strong> - Continuous Integration/ Continuous Deployment (Delivery)</li>
<li><strong>SDLC</strong> - Software Development Life Cycle</li>
<li><strong>Declarative</strong> - Declare what you want</li>
<li><strong>Imperative</strong> - How to get the desired state</li>
</ul>
<h2>1.4 Explore approaches to IaC</h2>
<ul>
<li>Imperative Approach<ul>
<li>Procedural Approach</li>
<li>Answers How?</li>
<li>Example Tools: AWS Cli, Python/Boto3</li>
</ul>
</li>
<li>Declarative Approach<ul>
<li>Answers What?</li>
<li>Example Tools: AWS CloudFormation, Terraform</li>
<li>We can change things easily for example AWS instance type</li>
<li>Tool does everything for us</li>
</ul>
</li>
</ul>
<h1>Chapter 2: Terraform</h1>
<h2>2.1 What is Terraform?</h2>
<ul>
<li>Terraform is a cross-platform command line tool</li>
<li>Declarative IaC tool<ul>
<li>We define what we want and Terraform will create it for us</li>
</ul>
</li>
<li>Also, an Online Service<ul>
<li>Provided through Terraform Cloud</li>
<li>Remote execution, Secret Storage</li>
</ul>
</li>
<li>Terraform consists<ul>
<li><strong>Configuration</strong>: Configuration files to define what we want</li>
<li><strong>State</strong>: Like a Database which stores the current state and can be stored anywhere like in local PC, S3, GCS, Google Drive, etc<ul>
<li>State is the Terraform view of the world</li>
<li>Terraform looks here instead of cloud provider</li>
<li>Terraform compares <strong>Config and State</strong> to create-destroy resource</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>2.2 Install Terraform</h2>
<p><a href="https://www.Terraform.io/downloads.html">https://www.Terraform.io/downloads.html</a></p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span>-version
Terraform<span class="w"> </span>v0.14.4
</code></pre></div>

<h2>2.3 Terraform Tour</h2>
<p>Initialize Terraform</p>
<div class="highlight"><pre><span></span><code>╭─sagar-giri@PCN-489<span class="w"> </span>~/IdeaProjects/HelloTerraform
╰─$<span class="w"> </span>terraform<span class="w"> </span>init
Terraform<span class="w"> </span>initialized<span class="w"> </span><span class="k">in</span><span class="w"> </span>an<span class="w"> </span>empty<span class="w"> </span>directory!

The<span class="w"> </span>directory<span class="w"> </span>has<span class="w"> </span>no<span class="w"> </span>Terraform<span class="w"> </span>configuration<span class="w"> </span>files.<span class="w"> </span>You<span class="w"> </span>may<span class="w"> </span>begin<span class="w"> </span>working
with<span class="w"> </span>Terraform<span class="w"> </span>immediately<span class="w"> </span>by<span class="w"> </span>creating<span class="w"> </span>Terraform<span class="w"> </span>configuration<span class="w"> </span>files.
</code></pre></div>

<p>Plan Terraform</p>
<div class="highlight"><pre><span></span><code>╭─sagar-giri@PCN-489<span class="w"> </span>~/IdeaProjects/HelloTerraform
╰─$<span class="w"> </span>terraform<span class="w"> </span>plan

Error:<span class="w"> </span>No<span class="w"> </span>configuration<span class="w"> </span>files

Plan<span class="w"> </span>requires<span class="w"> </span>configuration<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>present.<span class="w"> </span>Planning<span class="w"> </span>without<span class="w"> </span>a<span class="w"> </span>configuration
would<span class="w"> </span>mark<span class="w"> </span>everything<span class="w"> </span><span class="k">for</span><span class="w"> </span>destruction,<span class="w"> </span>which<span class="w"> </span>is<span class="w"> </span>normally<span class="w"> </span>not<span class="w"> </span>what<span class="w"> </span>is<span class="w"> </span>desired.
If<span class="w"> </span>you<span class="w"> </span>would<span class="w"> </span>like<span class="w"> </span>to<span class="w"> </span>destroy<span class="w"> </span>everything,<span class="w"> </span>run<span class="w"> </span>plan<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>-destroy<span class="w"> </span>option.
Otherwise,<span class="w"> </span>create<span class="w"> </span>a<span class="w"> </span>Terraform<span class="w"> </span>configuration<span class="w"> </span>file<span class="w"> </span><span class="o">(</span>.tf<span class="w"> </span>file<span class="o">)</span><span class="w"> </span>and<span class="w"> </span>try<span class="w"> </span>again.
</code></pre></div>

<p>Apply</p>
<div class="highlight"><pre><span></span><code>╭─sagar-giri@PCN-489<span class="w"> </span>~/IdeaProjects/HelloTerraform
╰─$<span class="w"> </span>terraform<span class="w"> </span>apply<span class="w">                                                                                                 </span><span class="m">1</span><span class="w"> </span>↵

Error:<span class="w"> </span>No<span class="w"> </span>configuration<span class="w"> </span>files

Apply<span class="w"> </span>requires<span class="w"> </span>configuration<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>present.<span class="w"> </span>Applying<span class="w"> </span>without<span class="w"> </span>a<span class="w"> </span>configuration
would<span class="w"> </span>mark<span class="w"> </span>everything<span class="w"> </span><span class="k">for</span><span class="w"> </span>destruction,<span class="w"> </span>which<span class="w"> </span>is<span class="w"> </span>normally<span class="w"> </span>not<span class="w"> </span>what<span class="w"> </span>is<span class="w"> </span>desired.
If<span class="w"> </span>you<span class="w"> </span>would<span class="w"> </span>like<span class="w"> </span>to<span class="w"> </span>destroy<span class="w"> </span>everything,<span class="w"> </span>run<span class="w"> </span><span class="s1">&#39;Terraform destroy&#39;</span><span class="w"> </span>instead.
</code></pre></div>

<p>Destroy</p>
<div class="highlight"><pre><span></span><code>╭─sagar-giri@PCN-489<span class="w"> </span>~/IdeaProjects/HelloTerraform
╰─$<span class="w"> </span>terraform<span class="w"> </span>destroy
Do<span class="w"> </span>you<span class="w"> </span>really<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>destroy<span class="w"> </span>all<span class="w"> </span>resources?
<span class="w">  </span>Terraform<span class="w"> </span>will<span class="w"> </span>destroy<span class="w"> </span>all<span class="w"> </span>your<span class="w"> </span>managed<span class="w"> </span>infrastructure,<span class="w"> </span>as<span class="w"> </span>shown<span class="w"> </span>above.
<span class="w">  </span>There<span class="w"> </span>is<span class="w"> </span>no<span class="w"> </span>undo.<span class="w"> </span>Only<span class="w"> </span><span class="s1">&#39;yes&#39;</span><span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>accepted<span class="w"> </span>to<span class="w"> </span>confirm.

<span class="w">  </span>Enter<span class="w"> </span>a<span class="w"> </span>value:<span class="w"> </span>no

Destroy<span class="w"> </span>cancelled.
╭─sagar-giri@PCN-489<span class="w"> </span>~/IdeaProjects/HelloTerraform
╰─$<span class="w"> </span>terraform<span class="w"> </span>destroy<span class="w">                                                                                               </span><span class="m">1</span><span class="w"> </span>↵
Do<span class="w"> </span>you<span class="w"> </span>really<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>destroy<span class="w"> </span>all<span class="w"> </span>resources?
<span class="w">  </span>Terraform<span class="w"> </span>will<span class="w"> </span>destroy<span class="w"> </span>all<span class="w"> </span>your<span class="w"> </span>managed<span class="w"> </span>infrastructure,<span class="w"> </span>as<span class="w"> </span>shown<span class="w"> </span>above.
<span class="w">  </span>There<span class="w"> </span>is<span class="w"> </span>no<span class="w"> </span>undo.<span class="w"> </span>Only<span class="w"> </span><span class="s1">&#39;yes&#39;</span><span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>accepted<span class="w"> </span>to<span class="w"> </span>confirm.

<span class="w">  </span>Enter<span class="w"> </span>a<span class="w"> </span>value:<span class="w"> </span>yes

Destroy<span class="w"> </span>complete!<span class="w"> </span>Resources:<span class="w"> </span><span class="m">0</span><span class="w"> </span>destroyed.
</code></pre></div>

<p>Help (Look for the <em><strong>Main commands</strong></em> section)</p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span><span class="nb">help</span>
Usage:<span class="w"> </span>Terraform<span class="w"> </span><span class="o">[</span>global<span class="w"> </span>options<span class="o">]</span><span class="w"> </span>&lt;subcommand&gt;<span class="w"> </span><span class="o">[</span>args<span class="o">]</span>

The<span class="w"> </span>available<span class="w"> </span>commands<span class="w"> </span><span class="k">for</span><span class="w"> </span>execution<span class="w"> </span>are<span class="w"> </span>listed<span class="w"> </span>below.
The<span class="w"> </span>primary<span class="w"> </span>workflow<span class="w"> </span>commands<span class="w"> </span>are<span class="w"> </span>given<span class="w"> </span>first,<span class="w"> </span>followed<span class="w"> </span>by
less<span class="w"> </span>common<span class="w"> </span>or<span class="w"> </span>more<span class="w"> </span>advanced<span class="w"> </span>commands.

Main<span class="w"> </span>commands:
<span class="w">  </span>init<span class="w">          </span>Prepare<span class="w"> </span>your<span class="w"> </span>working<span class="w"> </span>directory<span class="w"> </span><span class="k">for</span><span class="w"> </span>other<span class="w"> </span>commands
<span class="w">  </span>validate<span class="w">      </span>Check<span class="w"> </span>whether<span class="w"> </span>the<span class="w"> </span>configuration<span class="w"> </span>is<span class="w"> </span>valid
<span class="w">  </span>plan<span class="w">          </span>Show<span class="w"> </span>changes<span class="w"> </span>required<span class="w"> </span>by<span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>configuration
<span class="w">  </span>apply<span class="w">         </span>Create<span class="w"> </span>or<span class="w"> </span>update<span class="w"> </span>infrastructure
<span class="w">  </span>destroy<span class="w">       </span>Destroy<span class="w"> </span>previously-created<span class="w"> </span>infrastructure

All<span class="w"> </span>other<span class="w"> </span>commands:
<span class="w">  </span>console<span class="w">       </span>Try<span class="w"> </span>Terraform<span class="w"> </span>expressions<span class="w"> </span>at<span class="w"> </span>an<span class="w"> </span>interactive<span class="w"> </span><span class="nb">command</span><span class="w"> </span>prompt
<span class="w">  </span>fmt<span class="w">           </span>Reformat<span class="w"> </span>your<span class="w"> </span>configuration<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>standard<span class="w"> </span>style
<span class="w">  </span>force-unlock<span class="w">  </span>Release<span class="w"> </span>a<span class="w"> </span>stuck<span class="w"> </span>lock<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>workspace
<span class="w">  </span>get<span class="w">           </span>Install<span class="w"> </span>or<span class="w"> </span>upgrade<span class="w"> </span>remote<span class="w"> </span>Terraform<span class="w"> </span>modules
<span class="w">  </span>graph<span class="w">         </span>Generate<span class="w"> </span>a<span class="w"> </span>Graphviz<span class="w"> </span>graph<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>steps<span class="w"> </span><span class="k">in</span><span class="w"> </span>an<span class="w"> </span>operation
<span class="w">  </span>import<span class="w">        </span>Associate<span class="w"> </span>existing<span class="w"> </span>infrastructure<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>Terraform<span class="w"> </span>resource
<span class="w">  </span>login<span class="w">         </span>Obtain<span class="w"> </span>and<span class="w"> </span>save<span class="w"> </span>credentials<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>remote<span class="w"> </span>host
<span class="w">  </span><span class="nb">logout</span><span class="w">        </span>Remove<span class="w"> </span>locally-stored<span class="w"> </span>credentials<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>remote<span class="w"> </span>host
<span class="w">  </span>output<span class="w">        </span>Show<span class="w"> </span>output<span class="w"> </span>values<span class="w"> </span>from<span class="w"> </span>your<span class="w"> </span>root<span class="w"> </span>module
<span class="w">  </span>providers<span class="w">     </span>Show<span class="w"> </span>the<span class="w"> </span>providers<span class="w"> </span>required<span class="w"> </span><span class="k">for</span><span class="w"> </span>this<span class="w"> </span>configuration
<span class="w">  </span>refresh<span class="w">       </span>Update<span class="w"> </span>the<span class="w"> </span>state<span class="w"> </span>to<span class="w"> </span>match<span class="w"> </span>remote<span class="w"> </span>systems
<span class="w">  </span>show<span class="w">          </span>Show<span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>state<span class="w"> </span>or<span class="w"> </span>a<span class="w"> </span>saved<span class="w"> </span>plan
<span class="w">  </span>state<span class="w">         </span>Advanced<span class="w"> </span>state<span class="w"> </span>management
<span class="w">  </span>taint<span class="w">         </span>Mark<span class="w"> </span>a<span class="w"> </span>resource<span class="w"> </span>instance<span class="w"> </span>as<span class="w"> </span>not<span class="w"> </span>fully<span class="w"> </span>functional
<span class="w">  </span>untaint<span class="w">       </span>Remove<span class="w"> </span>the<span class="w"> </span><span class="s1">&#39;tainted&#39;</span><span class="w"> </span>state<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span>resource<span class="w"> </span>instance
<span class="w">  </span>version<span class="w">       </span>Show<span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>Terraform<span class="w"> </span>version
<span class="w">  </span>workspace<span class="w">     </span>Workspace<span class="w"> </span>management

Global<span class="w"> </span>options<span class="w"> </span><span class="o">(</span>use<span class="w"> </span>these<span class="w"> </span>before<span class="w"> </span>the<span class="w"> </span>subcommand,<span class="w"> </span><span class="k">if</span><span class="w"> </span>any<span class="o">)</span>:
<span class="w">  </span>-chdir<span class="o">=</span>DIR<span class="w">    </span>Switch<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>different<span class="w"> </span>working<span class="w"> </span>directory<span class="w"> </span>before<span class="w"> </span>executing<span class="w"> </span>the
<span class="w">                </span>given<span class="w"> </span>subcommand.
<span class="w">  </span>-help<span class="w">         </span>Show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>output,<span class="w"> </span>or<span class="w"> </span>the<span class="w"> </span><span class="nb">help</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>specified<span class="w"> </span>subcommand.
<span class="w">  </span>-version<span class="w">      </span>An<span class="w"> </span><span class="nb">alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span><span class="s2">&quot;version&quot;</span><span class="w"> </span>subcommand.
</code></pre></div>

<p>Format the Terraform file</p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span>fmt
</code></pre></div>

<h2>2.4 The very "Basics of Terraform"</h2>
<p>Terraform uses HCL (<a href="https://github.com/hashicorp">HashiCorp</a> Configuration Language)</p>
<p>The extension of file ends with <code>.tf</code></p>
<p>Create <code>main.tf</code> inside a directory</p>
<div class="highlight"><pre><span></span><code><span class="s2">&quot;greeting&quot;</span><span class="w"> </span>{
<span class="w">   </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hello Terraform.&quot;</span>
<span class="w"> </span>}

<span class="w"> </span><span class="nv">provider</span><span class="w"> </span><span class="s2">&quot;random&quot;</span><span class="w"> </span>{}
</code></pre></div>

<p>Initialize Terraform</p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span>init

Initializing<span class="w"> </span>the<span class="w"> </span>backend...

Initializing<span class="w"> </span>provider<span class="w"> </span>plugins...
-<span class="w"> </span>Finding<span class="w"> </span>latest<span class="w"> </span>version<span class="w"> </span>of<span class="w"> </span>hashicorp/random...
-<span class="w"> </span>Installing<span class="w"> </span>hashicorp/random<span class="w"> </span>v3.0.1...
-<span class="w"> </span>Installed<span class="w"> </span>hashicorp/random<span class="w"> </span>v3.0.1<span class="w"> </span><span class="o">(</span>signed<span class="w"> </span>by<span class="w"> </span>HashiCorp<span class="o">)</span>

Terraform<span class="w"> </span>has<span class="w"> </span>created<span class="w"> </span>a<span class="w"> </span>lock<span class="w"> </span>file<span class="w"> </span>.Terraform.lock.hcl<span class="w"> </span>to<span class="w"> </span>record<span class="w"> </span>the<span class="w"> </span>provider
selections<span class="w"> </span>it<span class="w"> </span>made<span class="w"> </span>above.<span class="w"> </span>Include<span class="w"> </span>this<span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>your<span class="w"> </span>version<span class="w"> </span>control<span class="w"> </span>repository
so<span class="w"> </span>that<span class="w"> </span>Terraform<span class="w"> </span>can<span class="w"> </span>guarantee<span class="w"> </span>to<span class="w"> </span>make<span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>selections<span class="w"> </span>by<span class="w"> </span>default<span class="w"> </span>when
you<span class="w"> </span>run<span class="w"> </span><span class="s2">&quot;Terraform init&quot;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>future.

Terraform<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>successfully<span class="w"> </span>initialized!

You<span class="w"> </span>may<span class="w"> </span>now<span class="w"> </span>begin<span class="w"> </span>working<span class="w"> </span>with<span class="w"> </span>Terraform.<span class="w"> </span>Try<span class="w"> </span>running<span class="w"> </span><span class="s2">&quot;terraform plan&quot;</span><span class="w"> </span>to<span class="w"> </span>see
any<span class="w"> </span>changes<span class="w"> </span>that<span class="w"> </span>are<span class="w"> </span>required<span class="w"> </span><span class="k">for</span><span class="w"> </span>your<span class="w"> </span>infrastructure.<span class="w"> </span>All<span class="w"> </span>Terraform<span class="w"> </span>commands
should<span class="w"> </span>now<span class="w"> </span>work.

If<span class="w"> </span>you<span class="w"> </span>ever<span class="w"> </span><span class="nb">set</span><span class="w"> </span>or<span class="w"> </span>change<span class="w"> </span>modules<span class="w"> </span>or<span class="w"> </span>backend<span class="w"> </span>configuration<span class="w"> </span><span class="k">for</span><span class="w"> </span>Terraform,
rerun<span class="w"> </span>this<span class="w"> </span><span class="nb">command</span><span class="w"> </span>to<span class="w"> </span>reinitialize<span class="w"> </span>your<span class="w"> </span>working<span class="w"> </span>directory.<span class="w"> </span>If<span class="w"> </span>you<span class="w"> </span>forget,<span class="w"> </span>other
commands<span class="w"> </span>will<span class="w"> </span>detect<span class="w"> </span>it<span class="w"> </span>and<span class="w"> </span>remind<span class="w"> </span>you<span class="w"> </span>to<span class="w"> </span><span class="k">do</span><span class="w"> </span>so<span class="w"> </span><span class="k">if</span><span class="w"> </span>necessary.
</code></pre></div>

<p>Plan it</p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span>plan

An<span class="w"> </span>execution<span class="w"> </span>plan<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>generated<span class="w"> </span>and<span class="w"> </span>is<span class="w"> </span>shown<span class="w"> </span>below.
Resource<span class="w"> </span>actions<span class="w"> </span>are<span class="w"> </span>indicated<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>symbols:

Terraform<span class="w"> </span>will<span class="w"> </span>perform<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>actions:

Plan:<span class="w"> </span><span class="m">0</span><span class="w"> </span>to<span class="w"> </span>add,<span class="w"> </span><span class="m">0</span><span class="w"> </span>to<span class="w"> </span>change,<span class="w"> </span><span class="m">0</span><span class="w"> </span>to<span class="w"> </span>destroy.

Changes<span class="w"> </span>to<span class="w"> </span>Outputs:
<span class="w">  </span>+<span class="w"> </span><span class="nv">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hello Terraform.&quot;</span>

------------------------------------------------------------------------

Note:<span class="w"> </span>You<span class="w"> </span>didn<span class="s1">&#39;t specify an &quot;-out&quot; parameter to save this plan, so Terraform</span>
<span class="s1">can&#39;</span>t<span class="w"> </span>guarantee<span class="w"> </span>that<span class="w"> </span>exactly<span class="w"> </span>these<span class="w"> </span>actions<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>performed<span class="w"> </span><span class="k">if</span>
<span class="s2">&quot;Terraform apply&quot;</span><span class="w"> </span>is<span class="w"> </span>subsequently<span class="w"> </span>run.
</code></pre></div>

<p>Apply it. You might have to type <code>yes</code> in the middle of it.</p>
<p>After applying it creates a <code>.tfstate</code> file, and you should not touch the <code>.tfstate</code> file.</p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span>apply

An<span class="w"> </span>execution<span class="w"> </span>plan<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>generated<span class="w"> </span>and<span class="w"> </span>is<span class="w"> </span>shown<span class="w"> </span>below.
Resource<span class="w"> </span>actions<span class="w"> </span>are<span class="w"> </span>indicated<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>symbols:

Terraform<span class="w"> </span>will<span class="w"> </span>perform<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>actions:

Plan:<span class="w"> </span><span class="m">0</span><span class="w"> </span>to<span class="w"> </span>add,<span class="w"> </span><span class="m">0</span><span class="w"> </span>to<span class="w"> </span>change,<span class="w"> </span><span class="m">0</span><span class="w"> </span>to<span class="w"> </span>destroy.

Changes<span class="w"> </span>to<span class="w"> </span>Outputs:
<span class="w">  </span>+<span class="w"> </span><span class="nv">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hello Terraform.&quot;</span>

Do<span class="w"> </span>you<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>perform<span class="w"> </span>these<span class="w"> </span>actions?
<span class="w">  </span>Terraform<span class="w"> </span>will<span class="w"> </span>perform<span class="w"> </span>the<span class="w"> </span>actions<span class="w"> </span>described<span class="w"> </span>above.
<span class="w">  </span>Only<span class="w"> </span><span class="s1">&#39;yes&#39;</span><span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>accepted<span class="w"> </span>to<span class="w"> </span>approve.

<span class="w">  </span>Enter<span class="w"> </span>a<span class="w"> </span>value:<span class="w"> </span>yes


Apply<span class="w"> </span>complete!<span class="w"> </span>Resources:<span class="w"> </span><span class="m">0</span><span class="w"> </span>added,<span class="w"> </span><span class="m">0</span><span class="w"> </span>changed,<span class="w"> </span><span class="m">0</span><span class="w"> </span>destroyed.

Outputs:

<span class="nv">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hello Terraform.&quot;</span>
</code></pre></div>

<p>See the output</p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span>output
<span class="nv">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hello Terraform.&quot;</span>
</code></pre></div>

<p>Specify which output you want</p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span>output<span class="w"> </span>greeting
<span class="s2">&quot;Hello Terraform.&quot;</span>
</code></pre></div>

<h1>Chapter 3: Learning HCL</h1>
<h2>3.1 Overview of HCL structure</h2>
<p>By conventions <code>main.tf</code> , <code>outputs.tf</code> and <code>variables.tf</code> are required files inside a directory</p>
<p>Sometimes the <code>main.tf</code> file gets too big. In this case we use the submodules.</p>
<p>Example <code>main.tf</code> with AWS as a provider:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Terraform block is optional but it&#39;s a best practice to have it</span>
<span class="nb">terraform</span><span class="w"> </span><span class="p">{</span>
<span class="c1">  # required_version is the Terraform version which we want to apply</span>
<span class="w">  </span><span class="na">required_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&gt;=0.14.0&quot;</span>
<span class="p">}</span>

<span class="c1"># Which cloud provider you want to use</span>
<span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="c1">  # region is required</span>
<span class="w">  </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ap-northeast-1&quot;</span>

<span class="c1">  # Since I am putting this file in GitHub I do not EVER put my AWS credentials here.</span>
<span class="c1">  # Instead I use the environment variable or Terraform cloud or the ~/.aws/credentials file</span>
<span class="c1">  #access_keys = &quot;my-access-key&quot;</span>
<span class="c1">  #access_secret = &quot;my-secret-key&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h2>3.2 Terraform data sources and resources</h2>
<ul>
<li>Resources<ul>
<li>Resource is any object that you want to manage with Terraform. For example: S3, AWS EKS, GKE, VM's.</li>
<li>Resources are defined in the resource block</li>
<li>Declaring a resource tells Terraform that it should CREATE and manage the Resource described.</li>
<li>If the resource already exists, it must be imported into Terraform state.</li>
<li>Example: <code>resource "aws_s3_bucket" "Terraform-bucket-2021" {}</code></li>
<li>REF: <a href="https://www.Terraform.io/docs/configuration/blocks/resources/index.html">https://www.Terraform.io/docs/configuration/blocks/resources/index.html</a></li>
</ul>
</li>
<li>Data sources<ul>
<li>Data sources are resources that Terraform does not manage. For example: <em>Availability Zones, Account ID</em></li>
<li>We can use data source to get the availability zones to place EC2 instances in multiple AZ's</li>
<li>REF: <a href="https://www.Terraform.io/docs/configuration/data-sources.html">https://www.Terraform.io/docs/configuration/data-sources.html</a>
Example:</li>
</ul>
</li>
</ul>
<p><strong>Create a S3 bucket in AWS using resource block.</strong></p>
<div class="highlight"><pre><span></span><code><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">required_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&gt;=0.14.0&quot;</span>
<span class="p">}</span>

<span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ap-northeast-1&quot;</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;Terraform-bucket-2021&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="c1">  # bucket name should be unique.</span>
<span class="c1">  # If you don&#39;t provide any name, Terraform will create it for you and saves in outputs.tf file</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Terraform-bucket-2021&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>Plan and save the output to a file using command: <code>terraform plan -out s3.tfplan</code> . This will create a file named <code>s3.tfplan</code> with following output:</p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span>plan<span class="w"> </span>-out<span class="w"> </span>example.tfplan

An<span class="w"> </span>execution<span class="w"> </span>plan<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>generated<span class="w"> </span>and<span class="w"> </span>is<span class="w"> </span>shown<span class="w"> </span>below.
Resource<span class="w"> </span>actions<span class="w"> </span>are<span class="w"> </span>indicated<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>symbols:
<span class="w">  </span>+<span class="w"> </span>create

Terraform<span class="w"> </span>will<span class="w"> </span>perform<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>actions:

<span class="w">  </span><span class="c1"># aws_s3_bucket.Terraform-bucket-2021 will be created</span>
<span class="w">  </span>+<span class="w"> </span>resource<span class="w"> </span><span class="s2">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="s2">&quot;Terraform-bucket-2021&quot;</span><span class="w"> </span><span class="o">{</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">acceleration_status</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">acl</span><span class="w">                         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;private&quot;</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">arn</span><span class="w">                         </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">bucket</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Terraform-bucket-2021&quot;</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">bucket_domain_name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">bucket_regional_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">force_destroy</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">hosted_zone_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">id</span><span class="w">                          </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">region</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">request_payer</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">website_domain</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">website_endpoint</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>

<span class="w">      </span>+<span class="w"> </span>versioning<span class="w"> </span><span class="o">{</span>
<span class="w">          </span>+<span class="w"> </span><span class="nv">enabled</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">          </span>+<span class="w"> </span><span class="nv">mfa_delete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>

Plan:<span class="w"> </span><span class="m">1</span><span class="w"> </span>to<span class="w"> </span>add,<span class="w"> </span><span class="m">0</span><span class="w"> </span>to<span class="w"> </span>change,<span class="w"> </span><span class="m">0</span><span class="w"> </span>to<span class="w"> </span>destroy.

------------------------------------------------------------------------

This<span class="w"> </span>plan<span class="w"> </span>was<span class="w"> </span>saved<span class="w"> </span>to:<span class="w"> </span>example.tfplan

To<span class="w"> </span>perform<span class="w"> </span>exactly<span class="w"> </span>these<span class="w"> </span>actions,<span class="w"> </span>run<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span><span class="nb">command</span><span class="w"> </span>to<span class="w"> </span>apply:
<span class="w">    </span>Terraform<span class="w"> </span>apply<span class="w"> </span><span class="s2">&quot;example.tfplan&quot;</span>
</code></pre></div>

<p>Anything beginning with the <code>+</code> means Terraform will create this resource for us. In the output above, it's <code>+ create</code> which means the resource doesn't exist yet and Terraform will perform <code>create</code> operation on the resource.</p>
<p>Now, apply the plan using command: <code>terraform apply s3.tfplan</code></p>
<p>Once applied, following output will be seen:</p>
<div class="highlight"><pre><span></span><code>╰─$ terraform apply example.tfplan
aws_s3_bucket.Terraform-bucket-2021: Creating...
aws_s3_bucket.Terraform-bucket-2021: Creation complete after 5s [id=Terraform-bucket-2021]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

The state of your infrastructure has been saved to the path
below. This state is required to modify and destroy your
infrastructure, so keep it safe. To inspect the complete state
use the <span class="sb">`terraform show`</span> command.

State path: Terraform.tfstate
</code></pre></div>

<p>It means that the s3 bucket has been created.</p>
<p>Verify if the bucket exist using <code>aws s3 ls</code> command</p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>aws<span class="w"> </span>s3<span class="w"> </span>ls
<span class="m">2021</span>-01-16<span class="w"> </span><span class="m">19</span>:42:52<span class="w"> </span>Terraform-bucket-2021
</code></pre></div>

<p>Bucket is successfully created 🎉</p>
<blockquote>
<p><em>Note: In real world, you ought to share the plan with your colleagues and there's an agreement between collegues before applying it.</em></p>
</blockquote>
<h2>3.3 Terraform Outputs</h2>
<p>When we don't define some value (bucket name for example), Terraform will create the bucket name for us, and we can know the bucket details using Terraform outputs.</p>
<p>In above case, let's output the bucket information of <code>terraform-bucket-2021</code></p>
<p>To do that we need to create a output block</p>
<div class="highlight"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;Terraform-bucket-2021&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Terraform-bucket-2021&quot;</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;bucket_info&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="c1">  # &lt;syntax&gt; value = resource_type[.]label_name</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.Terraform-bucket-2021</span>
<span class="p">}</span>
</code></pre></div>

<p>Now, plan it <code>terraform plan -out s3.tfplan</code> . Here, the previous filename <code>s3.tfplan</code> will be replaced with the new fresh file.</p>
<p>Not apply the <code>s3.tfplan</code> using command <code>terraform apply s3.tfplan</code></p>
<p>You'll see following output:</p>
<div class="highlight"><pre><span></span><code>Apply<span class="w"> </span>complete!<span class="w"> </span>Resources:<span class="w"> </span><span class="m">0</span><span class="w"> </span>added,<span class="w"> </span><span class="m">0</span><span class="w"> </span>changed,<span class="w"> </span><span class="m">0</span><span class="w"> </span>destroyed.

Outputs:

<span class="nv">bucket_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;acceleration_status&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">  </span><span class="s2">&quot;acl&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;private&quot;</span>
<span class="w">  </span><span class="s2">&quot;arn&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::Terraform-bucket-2021&quot;</span>
<span class="w">  </span><span class="s2">&quot;bucket&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Terraform-bucket-2021&quot;</span>
<span class="w">  </span><span class="s2">&quot;bucket_domain_name&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Terraform-bucket-2021.s3.amazonaws.com&quot;</span>
<span class="w">  </span><span class="s2">&quot;bucket_prefix&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tostring<span class="o">(</span>null<span class="o">)</span>
<span class="w">  </span><span class="s2">&quot;bucket_regional_domain_name&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Terraform-bucket-2021.s3.ap-northeast-1.amazonaws.com&quot;</span>
<span class="w">  </span><span class="s2">&quot;cors_rule&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tolist<span class="o">([])</span>
<span class="w">  </span><span class="s2">&quot;force_destroy&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<span class="w">  </span><span class="s2">&quot;grant&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>toset<span class="o">([])</span>
<span class="w">  </span><span class="s2">&quot;hosted_zone_id&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Z2M4EHUR26P7ZW&quot;</span>
<span class="w">  </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Terraform-bucket-2021&quot;</span>
<span class="w">  </span><span class="s2">&quot;lifecycle_rule&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tolist<span class="o">([])</span>
<span class="w">  </span><span class="s2">&quot;logging&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>toset<span class="o">([])</span>
<span class="w">  </span><span class="s2">&quot;object_lock_configuration&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tolist<span class="o">([])</span>
<span class="w">  </span><span class="s2">&quot;policy&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tostring<span class="o">(</span>null<span class="o">)</span>
<span class="w">  </span><span class="s2">&quot;region&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ap-northeast-1&quot;</span>
<span class="w">  </span><span class="s2">&quot;replication_configuration&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tolist<span class="o">([])</span>
<span class="w">  </span><span class="s2">&quot;request_payer&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;BucketOwner&quot;</span>
<span class="w">  </span><span class="s2">&quot;server_side_encryption_configuration&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tolist<span class="o">([])</span>
<span class="w">  </span><span class="s2">&quot;tags&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tomap<span class="o">({})</span>
<span class="w">  </span><span class="s2">&quot;versioning&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tolist<span class="o">([</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;enabled&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<span class="w">      </span><span class="s2">&quot;mfa_delete&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">  </span><span class="o">])</span>
<span class="w">  </span><span class="s2">&quot;website&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tolist<span class="o">([])</span>
<span class="w">  </span><span class="s2">&quot;website_domain&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tostring<span class="o">(</span>null<span class="o">)</span>
<span class="w">  </span><span class="s2">&quot;website_endpoint&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tostring<span class="o">(</span>null<span class="o">)</span>
<span class="o">}</span>
</code></pre></div>

<p>As you can see <code>Apply complete! Resources: 0 added, 0 changed, 0 destroyed.</code> because no resources were created even though our <code>.tf</code> file has resource block.</p>
<p>You can also get the output using <code>terraform output</code> command like this: <code>terraform output bucket_info</code></p>
<p>Example:</p>
<p><strong>List output of availability zones of region configured in your AWS configuration</strong></p>
<p>First, create the data block because regions are not managed by Terraform and it's a data. And the output block. Since the output is from the data block, we define value as: <code>data.&lt;type&gt;.&lt;label&gt;</code></p>
<div class="highlight"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_availability_zones&quot;</span><span class="w"> </span><span class="nv">&quot;available&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;available&quot;</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;aws_availability_zones&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_availability_zones.available</span>
<span class="p">}</span>
</code></pre></div>

<p>Now, plan it <code>terraform plan -out s3.tfplan</code>  and apply <code>terraform apply s3.tfplan</code></p>
<p>You'll see following output:</p>
<div class="highlight"><pre><span></span><code>Apply<span class="w"> </span>complete!<span class="w"> </span>Resources:<span class="w"> </span><span class="m">0</span><span class="w"> </span>added,<span class="w"> </span><span class="m">0</span><span class="w"> </span>changed,<span class="w"> </span><span class="m">0</span><span class="w"> </span>destroyed.

Outputs:

<span class="nv">aws_availability_zones</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;all_availability_zones&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tobool<span class="o">(</span>null<span class="o">)</span>
<span class="w">  </span><span class="s2">&quot;blacklisted_names&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>toset<span class="o">(</span>null<span class="o">)</span><span class="w"> </span>/*<span class="w"> </span>of<span class="w"> </span>string<span class="w"> </span>*/
<span class="w">  </span><span class="s2">&quot;blacklisted_zone_ids&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>toset<span class="o">(</span>null<span class="o">)</span><span class="w"> </span>/*<span class="w"> </span>of<span class="w"> </span>string<span class="w"> </span>*/
<span class="w">  </span><span class="s2">&quot;exclude_names&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>toset<span class="o">(</span>null<span class="o">)</span><span class="w"> </span>/*<span class="w"> </span>of<span class="w"> </span>string<span class="w"> </span>*/
<span class="w">  </span><span class="s2">&quot;exclude_zone_ids&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>toset<span class="o">(</span>null<span class="o">)</span><span class="w"> </span>/*<span class="w"> </span>of<span class="w"> </span>string<span class="w"> </span>*/
<span class="w">  </span><span class="s2">&quot;filter&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>toset<span class="o">(</span>null<span class="o">)</span><span class="w"> </span>/*<span class="w"> </span>of<span class="w"> </span>object<span class="w"> </span>*/
<span class="w">  </span><span class="s2">&quot;group_names&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>toset<span class="o">([</span>
<span class="w">    </span><span class="s2">&quot;ap-northeast-1&quot;</span>,
<span class="w">  </span><span class="o">])</span>
<span class="w">  </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2021-01-16 10:53:54.916848 +0000 UTC&quot;</span>
<span class="w">  </span><span class="s2">&quot;names&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tolist<span class="o">([</span>
<span class="w">    </span><span class="s2">&quot;ap-northeast-1a&quot;</span>,
<span class="w">    </span><span class="s2">&quot;ap-northeast-1c&quot;</span>,
<span class="w">    </span><span class="s2">&quot;ap-northeast-1d&quot;</span>,
<span class="w">  </span><span class="o">])</span>
<span class="w">  </span><span class="s2">&quot;state&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;available&quot;</span>
<span class="w">  </span><span class="s2">&quot;zone_ids&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tolist<span class="o">([</span>
<span class="w">    </span><span class="s2">&quot;apne1-az4&quot;</span>,
<span class="w">    </span><span class="s2">&quot;apne1-az1&quot;</span>,
<span class="w">    </span><span class="s2">&quot;apne1-az2&quot;</span>,
<span class="w">  </span><span class="o">])</span>
<span class="o">}</span>
</code></pre></div>

<blockquote>
<p>Note: The output of AZ's can be used later on if we want to provision EC2 instances in multiple regions. We can use this output to do it so.</p>
</blockquote>
<h2>3.4 Interpolation in HCL</h2>
<p>Interpolation is just the means of concatenating different values to create one value. In case of S3 bucket the value of S3 bucket has to be globally unique. Hence, inorder to create a bucket with unique name, we can use interpolation.</p>
<p>Example:</p>
<p><strong>Create aws bucket which name has the </strong><strong><code>accountID</code></strong><strong> in it.</strong></p>
<div class="highlight"><pre><span></span><code><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_caller_identity&quot;</span><span class="w"> </span><span class="nv">&quot;current&quot;</span><span class="w"> </span><span class="p">{}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;bucket2&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${data.aws_caller_identity.current.account_id}-bucket2&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>Here <code>data.aws_caller_identity.current.account_id</code> is interpolated which is <code>account_id + "-bucket2"</code> got from the data block <code>aws_caller_identity</code></p>
<h2>3.5 Dependencies in Terraform</h2>
<p>Terraform has the concept of <code>implicit</code> and <code>explicit</code> dependencies.</p>
<p>Whe Terraform processes the HCL configs, it evaluates the dependency graph, and it'll create dependencies before it creates the dependent resource. If there is not any dependencies, Terraform will create resource in parallel which will give performance boost.</p>
<p>Example:</p>
<p>Implicit dependency resolve when the dependent resource already exists.</p>
<div class="highlight"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;bucket3&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${data.aws_caller_identity.current.account_id}-bucket3&quot;</span>
<span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="c1">    # I already have bucket2 available so this is implicit</span>
<span class="w">    </span><span class="na">dependency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucket2.arn</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Explicit dependency when the dependent resource does not exist yet, and we need to wait for it to be created first. (analogy depends</p>
<div class="highlight"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;bucket4&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${data.aws_caller_identity.current.account_id}-bucket4&quot;</span>
<span class="c1">  # Explicit</span>
<span class="w">  </span><span class="na">depends_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="nv">aws_s3_bucket.bucket3</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>To see the dependencies, generate the <code>dot</code> file using <code>terraform graph &gt; graph.dot</code></p>
<p>And paste the content in online tool <a href="https://dreampuf.github.io/GraphvizOnline/">https://dreampuf.github.io/GraphvizOnline/</a> to see the output.</p>
<p>The <code>terraform graph</code> command is only used for debugging purpose.</p>
<h2>3.6 Variables and Locals</h2>
<p>Variables are ways to get input to the Terraform config</p>
<p>Ways to provide variables:</p>
<ul>
<li>Using command line while applying</li>
<li>Specify them in files such as <code>.tfvars</code> or <code>.auto.tfvars</code> for complex data types</li>
<li>Using environment variables but all the environment variable name should have prefix of <code>TF_VAR_</code>
In Terraform config, we use <code>variable</code> block to define expected variables.</li>
</ul>
<p>Example:</p>
<p><strong>Create a S3 bucket, but the bucket name should be provided by the user</strong></p>
<div class="highlight"><pre><span></span><code><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;bucket_name&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>

<span class="c1">  # `default` is optional. If default is omitted, then value must be supplied</span>
<span class="c1">  # default = &quot;My_Bucket1234&quot;</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;bucket5&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.bucket_name</span>
<span class="p">}</span>
</code></pre></div>

<p>And when plan is executed, the bucket name is expected as an input value:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>terraform<span class="w"> </span>plan<span class="w"> </span>-out<span class="w"> </span>var.tfplan
var.bucket_name
<span class="w">  </span>Enter<span class="w"> </span>a<span class="w"> </span>value:<span class="w"> </span>MyPiBucket31415

An<span class="w"> </span>execution<span class="w"> </span>plan<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>generated<span class="w"> </span>and<span class="w"> </span>is<span class="w"> </span>shown<span class="w"> </span>below.
Resource<span class="w"> </span>actions<span class="w"> </span>are<span class="w"> </span>indicated<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>symbols:
<span class="w">  </span>+<span class="w"> </span>create

Terraform<span class="w"> </span>will<span class="w"> </span>perform<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>actions:

<span class="w">  </span><span class="c1"># aws_s3_bucket.bucket5 will be created</span>
<span class="w">  </span>+<span class="w"> </span>resource<span class="w"> </span><span class="s2">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="s2">&quot;bucket5&quot;</span><span class="w"> </span><span class="o">{</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">acceleration_status</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">acl</span><span class="w">                         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;private&quot;</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">arn</span><span class="w">                         </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">bucket</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MyPiBucket31415&quot;</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">bucket_domain_name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">bucket_regional_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">force_destroy</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">hosted_zone_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">id</span><span class="w">                          </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">region</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">request_payer</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">website_domain</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">      </span>+<span class="w"> </span><span class="nv">website_endpoint</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>

<span class="w">      </span>+<span class="w"> </span>versioning<span class="w"> </span><span class="o">{</span>
<span class="w">          </span>+<span class="w"> </span><span class="nv">enabled</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">          </span>+<span class="w"> </span><span class="nv">mfa_delete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>known<span class="w"> </span>after<span class="w"> </span>apply<span class="o">)</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>

Plan:<span class="w"> </span><span class="m">1</span><span class="w"> </span>to<span class="w"> </span>add,<span class="w"> </span><span class="m">0</span><span class="w"> </span>to<span class="w"> </span>change,<span class="w"> </span><span class="m">0</span><span class="w"> </span>to<span class="w"> </span>destroy.
</code></pre></div>

<p><strong>Local values</strong></p>
<p>Local values make Terraform configs more readable.</p>
<p>If we want to use same value multiple times in the code, it's better to save it as a local value.</p>
<p>We can have multiple locals, but the names should be unique because names are global.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="nb">locals</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">aws_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${data.aws_caller_identity.current.account_id}-${lower(data.aws_caller_identity.current.user_id)}&quot;</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;bucket6&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${local.aws_account}-bucket6&quot;</span>
<span class="p">}</span>
</code></pre></div>

<blockquote>
<p>Note: Here the
<code>lower()</code>
 is a Terraform function. See more here:
<a href="https://www.Terraform.io/docs/configuration/functions.html">https://www.Terraform.io/docs/configuration/functions.html</a></p>
</blockquote>
<h2>3.7 Conditionals and the Count property</h2>
<p>Count is the meta attribute of Terraform</p>
<p>Count means instead of creating 1 resource, you can define <code>n</code> number of count to replicate the same resource.</p>
<p>Example:</p>
<p><strong>Create 2 buckets</strong></p>
<div class="highlight"><pre><span></span><code><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;bucketX&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${local.aws_account}-bucket${count.index+7}&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>Q. What happens when <code>count=0</code> ?</p>
<p>Terraform will destroy all resource if created or not create anything if it's not created yet.</p>
<p><strong>We can also replicate resources using </strong><strong><code>for_each</code></strong>**  **</p>
<div class="highlight"><pre><span></span><code><span class="nb">locals</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">buckets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">bucket101</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mybucket101&quot;</span>
<span class="w">    </span><span class="na">bucket102</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mybucket102&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;bucketIterator&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">for_each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.buckets</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${local.aws_account}-${each.value}&quot;</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;bucketIterator&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucketIterator</span>
<span class="p">}</span>
</code></pre></div>

<p>We can also define list instead of map:</p>
<div class="highlight"><pre><span></span><code><span class="nb">locals</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">buckets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="s2">&quot;mybucket101&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;mybucket102&quot;</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;bucketIterator&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="c1">  # Since buckets is a list, we need to convert to set using toset()</span>
<span class="w">  </span><span class="na">for_each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">toset</span><span class="p">(</span><span class="nv">local.buckets</span><span class="p">)</span>
<span class="c1">  # Here we can use either .key or .value</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${local.aws_account}-${each.key}&quot;</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;bucketIterator&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.bucketIterator</span>
<span class="p">}</span>
</code></pre></div>

<p><code>count</code> vs <code>for_each</code></p>
<ul>
<li>
<p><code>count</code> is generally used for toggle switch when in development phase</p>
</li>
<li>
<p><code>for_each</code> is more powerful, as we can use map in <code>for_each</code> hence, better to use <code>for_each</code> in prod</p>
</li>
</ul>
<h2>3.8 Data types and operators</h2>
<p>REF: <a href="https://www.Terraform.io/docs/configuration/expressions/types.html">https://www.Terraform.io/docs/configuration/expressions/types.html</a></p>
<div class="highlight"><pre><span></span><code><span class="nb">locals</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">a_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;This is a String&quot;</span>
<span class="w">  </span><span class="na">a_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">3.1415</span>
<span class="w">  </span><span class="na">a_boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="na">a_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;element1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="no">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">]</span>
<span class="w">  </span><span class="p">]</span>
<span class="w">  </span><span class="nb">a_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;value&quot;</span>
<span class="w">    </span><span class="na">nums</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">]</span>
<span class="w">    </span><span class="na">is_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="nb">configs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">instance_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;t2.micro&quot;</span>
<span class="w">      </span><span class="na">vpc_enabled</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="c1">  # Operators</span>
<span class="w">  </span><span class="na">operators</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="m">3</span><span class="err">+</span><span class="m">3</span><span class="p">)</span><span class="err">-</span><span class="p">(</span><span class="m">3</span><span class="err">*</span><span class="m">3</span><span class="err">/</span><span class="m">3</span><span class="p">)</span>

<span class="c1">  # Logical</span>
<span class="w">  </span><span class="na">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span><span class="no">true</span>
<span class="w">  </span><span class="na">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="no">false</span>

<span class="c1">  # Comparison</span>
<span class="w">  </span><span class="na">gt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">2</span>
<span class="w">  </span><span class="na">lt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="m">9</span>
<span class="w">  </span><span class="na">eq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="na">4</span><span class="w"> </span><span class="o">=</span><span class="p">=</span><span class="w"> </span><span class="m">4</span>
<span class="w">  </span><span class="na">neq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="p">!=</span><span class="w"> </span><span class="m">5</span>
<span class="p">}</span>
</code></pre></div>

<p>Example:</p>
<p><strong>Terraform config to create </strong><strong><code>n</code></strong><strong> number of buckets where </strong><strong><code>n</code></strong><strong> not more than </strong><strong><code>5</code></strong>** **</p>
<div class="highlight"><pre><span></span><code><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;bucket_count&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">number</span>
<span class="p">}</span>

<span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_caller_identity&quot;</span><span class="w"> </span><span class="nv">&quot;current&quot;</span><span class="w"> </span><span class="p">{}</span>

<span class="nb">locals</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">min_bucket_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
<span class="c1">  # Conditional operators similar to ternary operator</span>
<span class="w">  </span><span class="na">num_buckets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.bucket_count</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="nv">local.min_bucket_count</span><span class="p">:</span><span class="w"> </span><span class="nv">var.bucket_count</span>
<span class="w">  </span><span class="na">aws_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${data.aws_caller_identity.current.account_id}-${lower(data.aws_caller_identity.current.user_id)}&quot;</span>
<span class="p">}</span>

<span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;buckets&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.num_buckets</span>
<span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${local.aws_account}-buckets${count.index+7}&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h2>3.9 Functions</h2>
<p>REF: <a href="https://www.Terraform.io/docs/configuration/functions.html">https[://www.Terraform.io/docs/configuration/functions.html](https://www.Terraform.io/docs/configuration/functions.html)</a></p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="nb">locals</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">timestamp</span><span class="p">()</span>
<span class="w">  </span><span class="na">current_month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">formatdate</span><span class="p">(</span><span class="s2">&quot;MMMM&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">local.ts</span><span class="p">)</span>
<span class="w">  </span><span class="na">tomorrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">formatdate</span><span class="p">(</span><span class="s2">&quot;MMMM&quot;, timeadd(local.ts, &quot;24h&quot;</span><span class="p">))</span>
<span class="w">  </span><span class="na">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">upper</span><span class="p">(</span><span class="s2">&quot;lowercase&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="na">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">lower</span><span class="p">(</span><span class="s2">&quot;UPPERCASE&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;func&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${local.ts} ${local.current_month} ${local.tomorrow} ${local.upper} ${local.lower}&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>Output:</p>
<div class="highlight"><pre><span></span><code>Apply<span class="w"> </span>complete!<span class="w"> </span>Resources:<span class="w"> </span><span class="m">0</span><span class="w"> </span>added,<span class="w"> </span><span class="m">0</span><span class="w"> </span>changed,<span class="w"> </span><span class="m">0</span><span class="w"> </span>destroyed.

Outputs:

<span class="nv">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2021-01-16T15:36:41Z January January LOWERCASE uppercase&quot;</span>
</code></pre></div>

<h2>3.10 Iterations in collections</h2>
<p>HCL uses <code>for</code> syntax dfor iterating over list values</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="nb">locals</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">my_list</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;one&quot;, &quot;two&quot;, &quot;three&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="na">upper_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="err">for</span><span class="w"> </span><span class="err">item</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="nv">local.my_list</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nf">upper</span><span class="p">(</span><span class="err">item</span><span class="p">)]</span>
<span class="w">  </span><span class="nb">upper_map</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">item</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="nv">local.my_list</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="na">item</span><span class="w"> </span><span class="o">=</span><span class="err">&gt;</span><span class="w"> </span><span class="nf">upper</span><span class="p">(</span><span class="err">item</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="c1">  # Filtering</span>
<span class="w">  </span><span class="na">n</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">]</span>
<span class="w">  </span><span class="na">evens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="err">for</span><span class="w"> </span><span class="err">i</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="nv">local.n</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="err">i</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">i</span><span class="w"> </span><span class="err">%</span><span class="w"> </span><span class="na">2</span><span class="w"> </span><span class="o">=</span><span class="p">=</span><span class="w"> </span><span class="m">0</span><span class="p">]</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;my_list&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.my_list</span>
<span class="p">}</span>
<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;upper_list&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.upper_list</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;upper_map&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.upper_map</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;evens&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">local.evens</span>
<span class="p">}</span>
</code></pre></div>

<p>Output after apply:</p>
<div class="highlight"><pre><span></span><code>Apply<span class="w"> </span>complete!<span class="w"> </span>Resources:<span class="w"> </span><span class="m">0</span><span class="w"> </span>added,<span class="w"> </span><span class="m">0</span><span class="w"> </span>changed,<span class="w"> </span><span class="m">0</span><span class="w"> </span>destroyed.

Outputs:

<span class="nv">evens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="w">  </span><span class="m">2</span>,
<span class="w">  </span><span class="m">4</span>,
<span class="w">  </span><span class="m">6</span>,
<span class="w">  </span><span class="m">8</span>,
<span class="o">]</span>
<span class="nv">my_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="w">  </span><span class="s2">&quot;one&quot;</span>,
<span class="w">  </span><span class="s2">&quot;two&quot;</span>,
<span class="w">  </span><span class="s2">&quot;three&quot;</span>,
<span class="o">]</span>
<span class="nv">upper_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="w">  </span><span class="s2">&quot;ONE&quot;</span>,
<span class="w">  </span><span class="s2">&quot;TWO&quot;</span>,
<span class="w">  </span><span class="s2">&quot;THREE&quot;</span>,
<span class="o">]</span>
<span class="nv">upper_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;one&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ONE&quot;</span>
<span class="w">  </span><span class="s2">&quot;three&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;THREE&quot;</span>
<span class="w">  </span><span class="s2">&quot;two&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;TWO&quot;</span>
<span class="o">}</span>
</code></pre></div>

<h2>3.11 Directives and heredocs</h2>
<ul>
<li><code>heredocs</code><ul>
<li>is a multiline string that is used to create an inline JSON documents</li>
<li>They are used in outputs, variables description and inline documents
Example:</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nb">locals</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="w">  </span><span class="na">nums</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">]</span>
<span class="p">}</span>
<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;heredocs&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="c1">  # EOT means EOF</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;-</span><span class="dl">EOT</span>
<span class="sh">    This is the `heredoc`.</span>
<span class="sh">    This is multiline String.</span>
<span class="sh">    Used for writing documentations.</span>
<span class="dl">  EOT</span>
<span class="c1">  # Dont forget EOT at the end</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;directive&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;-</span><span class="dl">EOT</span>
<span class="sh">    We can use directive in heredoc.</span>
<span class="sh">    %{if local.count == 0}</span>
<span class="sh">    The count is 0, destroying everything...</span>
<span class="sh">    %{else}</span>
<span class="sh">    The count is ${local.count}</span>
<span class="sh">    %{endif}</span>
<span class="dl">  EOT</span>
<span class="p">}</span>

<span class="kr">output</span><span class="w"> </span><span class="nv">&quot;iterated-directive&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;-</span><span class="dl">EOT</span>
<span class="sh">    Directive can also be iterated.</span>
<span class="sh">    %{for num in local.nums}</span>
<span class="sh">    ${num}</span>
<span class="sh">    %{endfor}</span>
<span class="dl">  EOT</span>
<span class="p">}</span>
</code></pre></div>

<p>Output after apply:</p>
<div class="highlight"><pre><span></span><code>Apply<span class="w"> </span>complete!<span class="w"> </span>Resources:<span class="w"> </span><span class="m">0</span><span class="w"> </span>added,<span class="w"> </span><span class="m">0</span><span class="w"> </span>changed,<span class="w"> </span><span class="m">0</span><span class="w"> </span>destroyed.

Outputs:

<span class="nv">directive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;EOT</span>
<span class="s">We can use directive in heredoc.</span>

<span class="s">The count is 0, destroying everything...</span>


<span class="s">EOT</span>
<span class="nv">heredocs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;EOT</span>
<span class="s">This is the `heredoc`.</span>
<span class="s">This is multiline String.</span>
<span class="s">Used for writing documentations.</span>

<span class="s">EOT</span>
iterated-directive<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;EOT</span>
<span class="s">Directive can also be iterated.</span>

<span class="s">1</span>

<span class="s">2</span>

<span class="s">3</span>


<span class="s">EOT</span>
</code></pre></div>

<h2>3.12 Clean up</h2>
<p>Since we created multiple buckets and all, it's time to clean up.</p>
<p>Even though the buckets don't cost any, it's wise to clean up since we're just playing with Terraform in development mode.</p>
<p>First look for states that's tracked by Terraform using <code>terraform state list</code> . If it shows bunch of outputs of your bucket, execute <code>terraform destroy</code> which will destroy all resources that were created.</p>
<h1>Chapter 4: Code Re-Use for applying DRY</h1>
<h2>4.1 Understanding Terraform Modules</h2>
<p>What is a module in Terraform?</p>
<ul>
<li>All Terraform is in a module. The top level module is called the Root module</li>
<li>Modules are just a directory that contains Terraform file, and they can be nested</li>
<li>Modules can be imported which are already available</li>
<li>Modules written by others can be get here <a href="https://registry.Terraform.io">https://registry.Terraform.io</a></li>
<li>Module helps in implementing DRY principle</li>
<li>Module naming convention (if you want to publish to Terraform registry)<ul>
<li><code>terraform-&lt;PROVIDER&gt;-&lt;NAME&gt;</code></li>
<li><code>&lt;NAME&gt;</code> can contain hyphens
Module layout</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>├──<span class="w"> </span>Terraform-aws-s3
│<span class="w">   </span>├──<span class="w"> </span>README.md
│<span class="w">   </span>├──<span class="w"> </span>datas.tf
│<span class="w">   </span>├──<span class="w"> </span>locals.tf
│<span class="w">   </span>├──<span class="w"> </span>main.tf
│<span class="w">   </span>├──<span class="w"> </span>outputs.tf
│<span class="w">   </span>├──<span class="w"> </span>variables.tf
│<span class="w">   </span>└──<span class="w"> </span>versions.tf
</code></pre></div>

<p>You can use <a href="https://github.com/QuiNovas/cookiecutter-Terraform-module">https://github.com/QuiNovas/cookiecutter-Terraform-module</a> to automate the process of creating these files</p>
<p>To use module</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Module located in local filesystem</span>
<span class="k">module</span> <span class="s">&quot;local-module&quot;</span> {
    <span class="nb">source</span> = <span class="s">&quot;/path/to/module&quot;</span>
}

<span class="c1"># Module which is published</span>
<span class="k">module</span> <span class="s">&quot;published-module&quot;</span> {
    <span class="nb">source</span> = <span class="s">&quot;rojopolis/Terraform-aws-lambda-python-archive&quot;</span>
    <span class="nb">version</span> = <span class="s">&quot;1.2.3&quot;</span>
}

<span class="c1"># Module which is in GitHub</span>
<span class="k">module</span> <span class="s">&quot;github-module&quot;</span> {
    <span class="nb">source</span> = <span class="s">&quot;https://github.com/rojopolis/Terraform-aws-lambda-python-archive&quot;</span>
}
</code></pre></div>

<p>Play with <a href="https://github.com/rojopolis/Terraform-aws-lambda-python-archive/">https://github.com/rojopolis/Terraform-aws-lambda-python-archive/</a> to know about modules.</p>
<h2>4.2 Distributing modules</h2>
<ul>
<li>Name the module properly <code>terraform-&lt;PROVIDER&gt;-&lt;NAME&gt;</code></li>
<li>Should be in public repository in GitHub.</li>
<li>Should have license and examples</li>
<li>Repo should be released with a tag</li>
<li>Sign-in to <a href="https://registry.Terraform.io">https://registry.Terraform.io</a></li>
<li>Select the repo which is named correctly</li>
<li>Done 🎉</li>
<li>Profit 🏦</li>
</ul>
<h1>Chapter 5: Collaboration with Terraform</h1>
<h2>5.1 Terraform backends</h2>
<ul>
<li>Backend is a shared storage medium that stores state files</li>
<li>Backends officially supports blocking</li>
<li>Blocking is required inorder to prevent multiple user's updating resources at the same time</li>
<li>Most of the providers support blocking</li>
<li>We can use S3 as a backend provider</li>
<li>Backend provider is not in Terraform
Example:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">required_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&gt;=0.14.0&quot;</span>
<span class="w">  </span><span class="kr">backend</span><span class="w"> </span><span class="nv">&quot;s3&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="c1">    # bucket should already exist</span>
<span class="w">    </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my-Terraform-backend&quot;</span>
<span class="w">    </span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sagar-Terraform-resources&quot;</span>
<span class="w">    </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ap-northeast-1&quot;</span>
<span class="c1">    # dynamo db table also should already exist</span>
<span class="w">    </span><span class="na">dynamodb_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sagar-Terraform-lock&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>You must <code>init</code> again inorder to change the backend.</p>
<p>Locks are stored in dynamodb table. Whoever acquires the lock first has the precedence of getting the resource.</p>
<p>We can also have remote backend</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="kr">backend</span><span class="w"> </span><span class="nv">&quot;remote&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">hostname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;app.Terraform.io&quot;</span>
<span class="w">    </span><span class="na">organization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;beBit&quot;</span>
<span class="w">    </span><span class="nb">workspace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hello-Terraform&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>

<p>If we change the S3 backend to remote backend, we need to do <code>terraform init</code> again which will ask us if we'd like to move the state file from S3 to the remote backend.</p>
<h2>5.2 Terraform workspaces</h2>
<ul>
<li>Workspace helps us to create different environment with the same sets of Terraform configurations.</li>
<li>You can view the list of your Terraform workspaces using the command <code>terraform workspace list</code></li>
<li>The default workspace name is called <code>default</code></li>
<li>You can not delete the default workspace</li>
<li>Execute <code>terraform workspace --help</code> to view the workspaces sub-commands</li>
</ul>
<p>Create a new workspace:</p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span>workspace<span class="w"> </span>new<span class="w"> </span>staging
Created<span class="w"> </span>and<span class="w"> </span>switched<span class="w"> </span>to<span class="w"> </span>workspace<span class="w"> </span><span class="s2">&quot;staging&quot;</span>!

You<span class="err">&#39;</span>re<span class="w"> </span>now<span class="w"> </span>on<span class="w"> </span>a<span class="w"> </span>new,<span class="w"> </span>empty<span class="w"> </span>workspace.<span class="w"> </span>Workspaces<span class="w"> </span>isolate<span class="w"> </span>their<span class="w"> </span>state,
so<span class="w"> </span><span class="k">if</span><span class="w"> </span>you<span class="w"> </span>run<span class="w"> </span><span class="s2">&quot;terraform plan&quot;</span><span class="w"> </span>Terraform<span class="w"> </span>will<span class="w"> </span>not<span class="w"> </span>see<span class="w"> </span>any<span class="w"> </span>existing<span class="w"> </span>state
<span class="k">for</span><span class="w"> </span>this<span class="w"> </span>configuration.
</code></pre></div>

<p>List the workspaces:</p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span>workspace<span class="w"> </span>list
<span class="w">  </span>default
*<span class="w"> </span>staging
</code></pre></div>

<p>Where the <code>*</code> is the current one, and we can also use <code>terraform workspace show</code> to get the current workspace.</p>
<p>Switch the workspace back to <code>default</code></p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span>workspace<span class="w"> </span><span class="k">select</span><span class="w"> </span>default<span class="w">                                                                                                                                                                                              </span><span class="m">1</span><span class="w"> </span>↵
Switched<span class="w"> </span>to<span class="w"> </span>workspace<span class="w"> </span><span class="s2">&quot;default&quot;</span>.
</code></pre></div>

<p>Deleting the workspace:</p>
<div class="highlight"><pre><span></span><code>╰─$<span class="w"> </span>terraform<span class="w"> </span>workspace<span class="w"> </span>delete<span class="w"> </span>staging
Deleted<span class="w"> </span>workspace<span class="w"> </span><span class="s2">&quot;staging&quot;</span>!
</code></pre></div>

<blockquote>
<p>Note: The workspace should be clean i.e. destroyed before deleting it.
Learn more here: <a href="https://www.Terraform.io/docs/state/workspaces.html">https://www.Terraform.io/docs/state/workspaces.html</a></p>
</blockquote>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://sagargiri.com/tag/terraform">Terraform</a>
      <a href="https://sagargiri.com/tag/iac">IAC</a>
      <a href="https://sagargiri.com/tag/terraform-cloud">Terraform Cloud</a>
    </p>
  </div>






</article>

<footer>
<p>&copy; 2025 </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Sagar's Blog ",
  "url" : "https://sagargiri.com",
  "image": "/images/title.png",
  "description": "programming, python, CS, AWS, Django"
}
</script>
</body>
</html>